<!doctype html>
<html>
	<head>
		<title>Connectivity</title>
		<script src="/public/js/socket.io-1.2.0.js"></script>
		<script src="/public/js/jquery-1.11.1.js"></script>
		<script type="text/javascript" src="/public/bootstrap/js/bootstrap.min.js"></script>
		<script src="/public/js/angular.min.js"></script>
		<script src="/public/js/bootstrap-colorpicker-module.min.js"></script>
		
		
		<link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="/public/css/colorpicker.min.css" rel="stylesheet">




		<style>

	

			body{
				background-color: rgb(15,4,87);		
			}

			
			.stylish {
				    color: black;
				    background-color: white;
				    width: 50%;
				    margin-top: 20px;
				    margin-bottom: 20px;
				    line-height: 80px;
				    list-style-type: none;
				    border-radius: 20px;

			}

			#Heading {
				width:80%;
				height: 300px;
				background-color:rgb(77, 112, 219);
				color:white;
				margin-top: 50px;
				font-size: 48px;
			}

			#profile {
				position: relative;
				width: 10%;
				margin-left: 5%;
			}

			#profile > img {
				width: 100%;
				height: 100%;
			}

			#createNew{
				font-size: 18px;
				font-family:"Courier";
				padding-top:10px;
				padding-bottom:10px;
				background-color: rgb(15,4,87);
				color:white;
			}

			#tabs {
				width: 80%;
				background: none;
				border: none;
			}

			#tabs > ul {
				background: none;
			}

			#tabs > div {
				background-color: white;
			}

			.ui-widget-header {
				border-left: none;
				border-right: none;
				border-top: none;
			}

			#settings {
				position: fixed;
				right: 2%;
				top: 2%;
			}

			#settings > a > img {
				width: 52px;
				cursor: pointer;
			}

			.no-outline {
				outline: none !important;
				border: none !important;
			}

			#tabs {border: none}
			#tabs .ui-widget { border:none;  }
		    #tabs .ui-widget-header { border:none; }
		    #tabs .ui-widget-content { border:none; }

		    tabsUl {
			    list-style: none;
			    padding: 0;
			    margin: 0;
			}

			tabsLi {
			    float: left;
			    border: 1px solid #000;
			    border-bottom-width: 0;
			    margin: 3px 3px 0px 3px;
			    padding: 5px 5px 0px 5px;
			    background-color: #CCC;
			    color: #696969;
			}
			#mainView {
			    border: 1px solid black;
				clear: both;
				padding: 0 1em;
			}
			.active {
			    background-color: #FFF;
			    color: #000;
			}

			.tabsContainer {
				background: white;
			}

			.nav-tabs > li {
				border: none;
			}

			.tab-pane { 
				background: white;
			}

			.tab-pane > div > iframe {
				width: 80%;
				height: 100vh;
				overflow: scroll;
			}

			.friends > a > img {
				width: 100px;
				height: 100px;
			}

			#friendsContainer {
				width: 100%;
			}
			
			#friendsContainer > center > li {
				width: 100%;
			}

			li {
				list-style-type: none;
			}

			.fontPicker {
				position: fixed;
				background-color: white;
				left: 100px;
				top: -35px;
				width: 70%;
				border: solid 1px;
				display: none;
			}

			.choosenFont {
				width: 70%;
			}
			

		</style>
	</head>

	<body>
		
		<div ng-app="myApp" ng-controller="myController" ng-cloak>




		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
		  <div class="modal-dialog">

		    <!-- Modal content-->
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal">&times;</button>
		        <center><h4 class="modal-title">Your fonts</h4></center>
		      </div>
		      <div class="modal-body">
		        <ul>
		        	<li ng-repeat="number in numbers">

		        		<button type="button"
		        		 class="btn btn-default" 
		        		 colorpicker-position="bottom"
		        		 ng-model="number.color"
		        		 ng-style="{backgroundColor:number.color, color:number.color}"
		        		 colorpicker>
		        		 Color
		        		</button>

		        		<span class="choosenFont" ng-click="showFonts([$index])">
		        			{{number.font}}
		        		</span>

		        		<ul class="fontPicker" ng-model="number.font" ng-attr-id="{{ 'fontPicker-' + $index }}">
							<li ng-repeat="font in fonts" ng-click="clicked([$parent.$index], font)" ng-style="{fontFamily:font}" value="{{font}}">{{font}}</li>
						</ul>

		        	</li>
		        </ul>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary" data-dismiss="modal">Save</button>
		      </div>
		    </div>

		  </div>
		</div>


		<div id="settings">
			<a data-toggle="modal" data-target="#myModal">
			  <img src="/public/settings-icon.svg">
			</a>
		</div>


		<center>
			<div id="Heading">{{user}}</div>
		</center>

		<div id="profile">
			<img id="profilePic"></img>
			
		</div>

		<center>
			

		    <div class="container tabsContainer" >
			  <ul class="nav nav-tabs tabsUl">

			    <li class="tabsLi" ng-repeat="tab in tabs" ng-class="$first ? 'active' : ''">
			    	<a data-toggle="tab" href="#menu{{$index}}">{{tab.name}}</a>
			    </li>

			  </ul>

			  <div class="tab-content">

			    <div ng-repeat="tab in tabs" id="menu{{$index}}" ng-class="$first ? 'active in' : ''" class="tab-pane fade">
			    	<br/>
			      <div>
			      	<div class="locked"></div>
			      	<iframe ng-src="{{tab.iframe}}"></iframe>
			      </div>
			    </div>


			  </div>
			</div>

			<br/><br/><br/><br/>

			<center style="font-size:36px; color: white;">Friends</center>			
			<ul id="friendsContainer">
				<center>
				<li ng-repeat="friend in friends" class="friends">
					<a href="/profile?user={{friend._id}}">{{friend.user}} <img src="/imgs?user={{friend._id}}"></img></a>
				</li>
				</center>
			</ul>
 			

		</center>

		</div>
		
	</body>	


	<script type="text/javascript">

		function a() { console.log('a'); }

		function getQueryParams() {
			qs = document.location.search;
			qs = qs.split('+').join(' ');
			
			var params = {},
			tokens,
			re = /[?&]?([^=]+)=([^&]*)/g;
			
			while (tokens = re.exec(qs)) {
				params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
			}
			
			return params;
		}


		var app = angular.module('myApp', ['colorpicker.module']);

		function minLength(str, len) {
			while (str.length < len) {
				str = "0" + str;
			}
			return str;
		}

		app.filter('inverse', function() {
			return function(input) {
				if (input == undefined || input == null) return '#000000';
				
				var num = parseInt(input.substring(1), 16);

				var r = parseInt(input.substring(1, 3), 16);
				var g = parseInt(input.substring(3, 5), 16);
				var b = parseInt(input.substring(5, 7), 16);

				return '#' + minLength((255-r).toString(16), 2) + minLength((255-g).toString(16), 2) + minLength((255-b).toString(16), 2);
			};
		});

		app.controller('myController', ['$scope', '$interval', '$http', '$q', function($scope, $interval, $http, $q) {

			var user = getQueryParams().user;

			$scope.fonts = ["arial", "Palatino Linotype", "Book Antiqua"];

			$scope.selectedFont = '';
			$scope.clicked = function(num, font) {

				console.log("clicked " + num + " " + font);

				$scope.numbers[num].font = font;
				$('#fontPicker-' + num).toggle();
			}

			$scope.showFonts = function(num) {
				$('#fontPicker-' + num).toggle();
				console.log($('#fontPicker-' + num)[0]);
			}

		    $http.get("/getUsersDocuments?user="+user).success(function(reply) {
		    	$scope.tabs = reply.map(function(r) { r.iframe = "/np?doc=" + r._id; return r; });
		    });
		    $http.get("/api/user/info?user="+user).success(function(reply) {
		    	$scope.user = reply.user;
		    });
		    $http.get("/api/friends/get?user="+user).success(function(reply){
		    	$scope.friends = reply;
		    });
		    $http.get("/api/user/colors/get?user="+user).success(function(reply){
		    	$scope.numbers = reply.map(function(r) {
		    		r.font = r.font || "Select A Font";
		    		return r;
		    	});
		    });

		    

		    $('#myModal').on('hidden.bs.modal', function () {
			    console.log("hidden");
			    console.log($scope.numbers);

			    $http.post('/api/user/colors/update', {colors:$scope.numbers})
			    .then(
			    	function(response) {

			    	},
			    	function (err) {

			    	});
			});

		}]);



		$(document).ready(function() {
			var pic = $('#profile')[0];
			var back = $('#Heading')[0];

			var rect = pic.getBoundingClientRect();
			var headingRect = back.getBoundingClientRect();

			pic.style.height = rect.width + "px";

			pic.style.top = (rect.width + headingRect.height)/-2 + "px";



			 


			 $('#profilePic')[0].src = "/imgs?user=" + getQueryParams()['user'];

			 

		});

		

	</script>

	
</html>